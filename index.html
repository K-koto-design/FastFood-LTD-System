<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Randomize Bot - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --tg-blue: #24A1DE;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            padding: 40px 20px;
            margin: 0;
        }

        .app {
            background: var(--card);
            max-width: 500px;
            width: 100%;
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.05);
        }

        .logo {
            text-align: center;
            font-size: 24px;
            font-weight: 800;
            color: var(--tg-blue);
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .logo small { font-size: 14px; color: #64748b; font-weight: 400; }

        .field { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }

        input, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            box-sizing: border-box;
            font-family: inherit;
            transition: 0.3s;
        }

        input:focus { border-color: var(--tg-blue); outline: none; }

        .btn {
            background: var(--tg-blue);
            color: white;
            border: none;
            padding: 16px;
            width: 100%;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }

        .btn:hover { background: #0088cc; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(36,161,222,0.3); }

        .status {
            margin-top: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            display: none;
        }

        .active-label { color: #059669; font-weight: 800; display: flex; align-items: center; gap: 5px; }
        .count-box { font-size: 32px; font-weight: 800; margin: 10px 0; }
        .timer { color: #e11d48; font-family: monospace; font-weight: bold; }
    </style>
</head>
<body>

<div class="app">
    <div class="logo">
        Randomize Bot
        <small>–°–µ—Ä–≤–∏—Å –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π</small>
    </div>
    
    <div class="field">
        <label>–Æ–∑–µ—Ä–Ω–µ–π–º –∫–∞–Ω–∞–ª–∞</label>
        <input type="text" id="channel" placeholder="@–Ω–∞–∑–≤–∞–Ω–∏–µ_–∫–∞–Ω–∞–ª–∞">
    </div>

    <div class="field">
        <label>–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
        <textarea id="msg" rows="3">–ü—Ä–∏–≤–µ—Ç! –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ –ø—Ä–∏–∑–∞! üéÅ</textarea>
    </div>

    <div class="field">
        <label>–ö–æ–≥–¥–∞ –ø–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏?</label>
        <input type="datetime-local" id="date">
    </div>

    <button class="btn" onclick="start()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –∫–∞–Ω–∞–ª</button>

    <div id="statusBox" class="status">
        <div class="active-label">‚óè –†–û–ó–´–ì–†–´–® –ò–î–ï–¢</div>
        <div class="count-box"><span id="pCount">0</span> <small style="font-size: 14px; font-weight: 400; color: #64748b;">—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</small></div>
        <div style="font-size: 13px; color: #64748b;">–î–æ —Ñ–∏–Ω–∞–ª–∞: <span class="timer" id="timeLeft">--:--:--</span></div>
        <p style="font-size: 11px; margin-top: 15px; color: #94a3b8;">* –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏</p>
    </div>
</div>

<script>
    // === –í–°–¢–ê–í–¨–¢–ï –í–ê–® –¢–û–ö–ï–ù –°–Æ–î–ê ===
    const BOT_TOKEN = '–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨'; 
    // ===============================

    let participants = new Set();
    let isLive = false;
    let lastId = 0;
    let botName = "";

    async function call(method, body = {}) {
        const r = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/${method}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        return await r.json();
    }

    async function start() {
        const channel = document.getElementById('channel').value;
        const text = document.getElementById('msg').value;
        const targetDate = new Date(document.getElementById('date').value);

        if (!channel.startsWith('@')) return alert("–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @");
        if (isNaN(targetDate)) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!");

        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ –æ –±–æ—Ç–µ
        const me = await call('getMe');
        if (!me.ok) return alert("–û—à–∏–±–∫–∞ —Ç–æ–∫–µ–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é BOT_TOKEN –≤ –∫–æ–¥–µ.");
        botName = me.result.username;

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Å—Ç
        const post = await call('sendMessage', {
            chat_id: channel,
            text: text,
            reply_markup: {
                inline_keyboard: [[
                    { text: "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å! üôã‚Äç‚ôÇÔ∏è", url: `https://t.me/${botName}?start=join` }
                ]]
            }
        });

        if (post.ok) {
            document.getElementById('statusBox').style.display = 'block';
            isLive = true;
            runEngine(targetDate, channel);
        } else {
            alert("–û—à–∏–±–∫–∞: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª " + channel + " –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.");
        }
    }

    function runEngine(targetDate, channel) {
        const timer = setInterval(async () => {
            if (!isLive) return clearInterval(timer);

            const now = new Date();
            const diff = targetDate - now;

            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
            if (diff <= 0) {
                isLive = false;
                finish(channel);
                return;
            }

            // 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            document.getElementById('timeLeft').innerText = `${h}—á ${m}–º ${s}—Å`;

            // 3. –°–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            const upd = await call('getUpdates', { offset: lastId + 1 });
            if (upd.result) {
                upd.result.forEach(u => {
                    lastId = u.update_id;
                    if (u.message && u.message.text === '/start join') {
                        const user = u.message.from;
                        const label = user.first_name + (user.username ? ` (@${user.username})` : ` (ID:${user.id})`);
                        participants.add(label);
                    }
                });
                document.getElementById('pCount').innerText = participants.size;
            }
        }, 3000);
    }

    async function finish(channel) {
        const all = Array.from(participants);
        let winText = "";

        if (all.length === 0) {
            winText = "‚åõ –†–æ–∑—ã–≥—Ä—ã—à –∑–∞–≤–µ—Ä—à–µ–Ω, –Ω–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ –±—ã–ª–æ.";
        } else {
            const winner = all[Math.floor(Math.random() * all.length)];
            winText = `üéâ **–†–û–ó–´–ì–†–´–® –ó–ê–í–ï–†–®–ï–ù!**\n\nüèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${winner}\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${all.length}\n\n–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üëè`;
        }

        await call('sendMessage', {
            chat_id: channel,
            text: winText,
            parse_mode: 'Markdown'
        });

        alert("–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ –∫–∞–Ω–∞–ª–µ!");
        document.querySelector('.active-label').innerText = "‚óè –ó–ê–í–ï–†–®–ï–ù–û";
        document.querySelector('.active-label').style.color = "#64748b";
    }
</script>

</body>
</html>
