<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>K-Donalds Pro OS | FastFood LTD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --mcd-red: #da291c;
            --mcd-yellow: #ffbc0d;
            --dark: #272321;
            --white: #ffffff;
            --gray: #f4f4f4;
            --green: #28a745;
        }

        body { font-family: 'Arial', sans-serif; margin: 0; background: var(--gray); overflow: hidden; touch-action: manipulation; }

        .admin-nav { display: flex; background: var(--dark); padding: 5px; gap: 5px; overflow-x: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .nav-btn { padding: 12px 15px; border: none; border-radius: 8px; background: #444; color: white; cursor: pointer; white-space: nowrap; font-weight: bold; font-size: 13px; }
        .nav-btn.active { background: var(--mcd-red); }
        .fs-btn { background: var(--mcd-yellow); color: #000; margin-left: auto; }

        .screen { display: none; height: calc(100vh - 55px); padding: 15px; box-sizing: border-box; }
        .screen.active { display: flex; flex-direction: column; }

        .pos-container { display: flex; gap: 15px; height: 100%; overflow: hidden; }
        .menu-grid { flex: 2; display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; overflow-y: auto; padding-bottom: 20px; }
        .order-sidebar { flex: 1; background: white; border-radius: 12px; padding: 15px; display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        /* –ê–¥–º–∏–Ω-–∑–æ–Ω–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ */
        .admin-panel { background: #eee; padding: 10px; border-radius: 10px; margin-bottom: 10px; border: 1px dashed #ccc; }
        .admin-panel input { width: 90%; margin: 3px 0; padding: 5px; border-radius: 5px; border: 1px solid #ccc; }

        .menu-item { background: white; border-radius: 12px; padding: 10px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: 0.2s; position: relative; }
        .menu-item:hover { border-color: var(--mcd-yellow); }
        .menu-item img { width: 70px; height: 70px; object-fit: contain; border-radius: 5px; }
        .menu-item h3 { font-size: 14px; margin: 5px 0; }
        .delete-item { position: absolute; top: 2px; right: 2px; color: red; font-size: 12px; display: none; }
        .menu-item:hover .delete-item { display: block; }

        .cart-items { flex: 1; overflow-y: auto; font-size: 14px; margin: 10px 0; border-top: 1px solid #eee; padding-top: 10px; }
        .cart-row { display: flex; justify-content: space-between; margin-bottom: 5px; animation: slideIn 0.2s ease; }

        .kitchen-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; overflow-y: auto; }
        .order-card { background: white; border-top: 6px solid var(--mcd-red); border-radius: 10px; padding: 12px; }

        .display-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: 100%; }
        .column { background: white; border-radius: 20px; padding: 20px; text-align: center; }
        .number-list { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; font-size: 50px; font-weight: 800; }
        .ready-num { color: var(--green); animation: blink 1s infinite; }

        .terminal-wrap { margin: auto; width: 300px; background: #222; border-radius: 25px; padding: 40px; color: #0f0; text-align: center; border: 5px solid #444; font-family: 'Courier New', monospace; }
        .card-reader { width: 100%; height: 60px; background: #111; margin-top: 30px; border-radius: 8px; line-height: 60px; border: 2px dashed #333; cursor: pointer; }

        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        .btn-pay { background: var(--green); color: white; border: none; padding: 15px; border-radius: 8px; font-size: 18px; font-weight: bold; width: 100%; cursor: pointer; }
        .btn-add { background: var(--mcd-yellow); border: none; padding: 8px; border-radius: 5px; font-weight: bold; width: 100%; margin-top: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <nav class="admin-nav">
        <button class="nav-btn active" onclick="switchTab('kiosk', this)">üçî –ö–∏–æ—Å–∫</button>
        <button class="nav-btn" onclick="switchTab('cashier', this)">üí∞ –ö–∞—Å—Å–∞</button>
        <button class="nav-btn" onclick="switchTab('kitchen', this)">üë®‚Äçüç≥ –ö—É—Ö–Ω—è</button>
        <button class="nav-btn" onclick="switchTab('display', this)">üì∫ –¢–∞–±–ª–æ</button>
        <button class="nav-btn" onclick="switchTab('terminal', this)">üí≥ –¢–µ—Ä–º–∏–Ω–∞–ª</button>
        <button class="nav-btn fs-btn" onclick="toggleFullScreen()">‚õ∂ Fullscreen</button>
    </nav>

    <div id="kiosk" class="screen active">
        <div class="pos-container">
            <div class="menu-grid" id="kiosk-menu"></div>
            <div class="order-sidebar">
                <h2 style="margin:0">–í–∞—à –∑–∞–∫–∞–∑</h2>
                <div class="cart-items" id="kiosk-cart"></div>
                <h3 id="kiosk-total">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</h3>
                <button class="btn-pay" onclick="sendToTerminal('kiosk')">–û–ü–õ–ê–¢–ò–¢–¨</button>
            </div>
        </div>
    </div>

    <div id="cashier" class="screen">
        <div class="pos-container">
            <div class="menu-grid" id="cashier-menu"></div>
            <div class="order-sidebar" style="border-left: 8px solid var(--mcd-yellow)">
                <div class="admin-panel">
                    <strong style="font-size: 12px;">–î–û–ë–ê–í–ò–¢–¨ –¢–û–í–ê–† –í –ë–ê–ó–£</strong>
                    <input type="text" id="new-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –ë–∏–≥ –¢–µ–π—Å—Ç–∏)">
                    <input type="number" id="new-price" placeholder="–¶–µ–Ω–∞ (‚ÇΩ)">
                    <input type="text" id="new-img" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ (URL)">
                    <button class="btn-add" onclick="addNewProduct()">–°–û–•–†–ê–ù–ò–¢–¨ –í FIREBASE</button>
                </div>
                <h2 style="margin:0">–ß–µ–∫:</h2>
                <div class="cart-items" id="cashier-cart"></div>
                <h3 id="cashier-total">–ö –æ–ø–ª–∞—Ç–µ: 0 ‚ÇΩ</h3>
                <button class="btn-pay" style="background: var(--dark)" onclick="sendToTerminal('cashier')">–ö–ê–†–¢–ê</button>
                <button onclick="clearCart()" style="margin-top:10px; background:none; border:none; color:red; cursor:pointer;">‚úñ –û—á–∏—Å—Ç–∏—Ç—å —á–µ–∫</button>
            </div>
        </div>
    </div>

    <div id="kitchen" class="screen"><h1 style="text-align:center">–ú–û–ù–ò–¢–û–† –ö–£–•–ù–ò</h1><div class="kitchen-grid" id="kitchen-orders"></div></div>
    <div id="display" class="screen"><div class="display-container"><div class="column"><h2 style="color:var(--mcd-red)">–ì–û–¢–û–í–ò–¢–°–Ø</h2><div id="prep-numbers" class="number-list"></div></div><div class="column"><h2 style="color:var(--green)">–ì–û–¢–û–í–û</h2><div id="ready-numbers" class="number-list ready-num"></div></div></div></div>
    <div id="terminal" class="screen"><div class="terminal-wrap"><div id="term-msg">–û–ñ–ò–î–ê–ù–ò–ï...</div><div id="term-amount" style="font-size: 45px; margin: 25px 0;">0.00 ‚ÇΩ</div><div class="card-reader" onclick="processPayment()">–ü–†–ò–õ–û–ñ–ò–¢–ï –ö–ê–†–¢–£</div></div></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBX7BbbkBR7ITiayV132J9LlOqjh3l4AJs",
            authDomain: "fastfood-ltd-system.firebaseapp.com",
            databaseURL: "https://fastfood-ltd-system-default-rtdb.firebaseio.com",
            projectId: "fastfood-ltd-system",
            storageBucket: "fastfood-ltd-system.firebasestorage.app",
            messagingSenderId: "890141225952",
            appId: "1:890141225952:web:6ee1bf30e8408f355ef185",
            measurementId: "G-KP685P8817"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let cart = [];
        let total = 0;

        // --- –õ–û–ì–ò–ö–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ù–û–í–û–ì–û –¢–û–í–ê–†–ê –í –ë–ê–ó–£ ---
        function addNewProduct() {
            const name = document.getElementById('new-name').value;
            const price = document.getElementById('new-price').value;
            const img = document.getElementById('new-img').value || 'https://img.icons8.com/plasticine/100/hamburger.png';

            if (!name || !price) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É!");

            const productId = Date.now(); // —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏
            db.ref('menu/' + productId).set({
                name: name,
                price: parseInt(price),
                img: img
            }).then(() => {
                alert("–¢–æ–≤–∞—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω!");
                document.getElementById('new-name').value = '';
                document.getElementById('new-price').value = '';
                document.getElementById('new-img').value = '';
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –±–∞–∑—ã
        function deleteProduct(id) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä –∏–∑ –º–µ–Ω—é?")) {
                db.ref('menu/' + id).remove();
            }
        }

        // --- –ñ–ò–í–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ú–ï–ù–Æ –ò–ó FIREBASE ---
        db.ref('menu').on('value', snap => {
            const products = snap.val();
            const kioskGrid = document.getElementById('kiosk-menu');
            const cashierGrid = document.getElementById('cashier-menu');
            
            kioskGrid.innerHTML = '';
            cashierGrid.innerHTML = '';

            if (!products) {
                // –ï—Å–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞, –¥–æ–±–∞–≤–∏–º –ø—Ä–∏–º–µ—Ä
                kioskGrid.innerHTML = '<p>–ú–µ–Ω—é –ø—É—Å—Ç–æ. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞ –∫–∞—Å—Å–µ.</p>';
                return;
            }

            Object.keys(products).forEach(id => {
                const item = products[id];
                const html = `
                    <div class="menu-item" onclick="addToCart('${item.name}', ${item.price})">
                        <span class="delete-item" onclick="event.stopPropagation(); deleteProduct('${id}')">‚úñ</span>
                        <img src="${item.img}">
                        <h3>${item.name}</h3>
                        <p>${item.price} ‚ÇΩ</p>
                    </div>`;
                kioskGrid.innerHTML += html;
                cashierGrid.innerHTML += html;
            });
        });

        // --- –û–°–¢–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê (–ö–∏–æ—Å–∫, –ö—É—Ö–Ω—è, –¢–µ—Ä–º–∏–Ω–∞–ª) ---
        function addToCart(name, price) {
            cart.push({name, price});
            total += price;
            updateUI();
        }

        function updateUI() {
            const rows = cart.map(i => `<div class="cart-row"><span>${i.name}</span><span>${i.price} ‚ÇΩ</span></div>`).join('');
            document.getElementById('kiosk-cart').innerHTML = rows;
            document.getElementById('cashier-cart').innerHTML = rows;
            document.getElementById('kiosk-total').innerText = `–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ`;
            document.getElementById('cashier-total').innerText = `–ö –æ–ø–ª–∞—Ç–µ: ${total} ‚ÇΩ`;
        }

        function clearCart() { cart = []; total = 0; updateUI(); }

        function sendToTerminal(from) {
            if (total === 0) return alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞");
            db.ref('system/terminal').set({ amount: total, items: cart.map(i => i.name), status: 'waiting' });
            switchTab('terminal', document.querySelectorAll('.nav-btn')[4]);
        }

        function processPayment() {
            db.ref('system/terminal').once('value', snap => {
                const val = snap.val();
                if (!val || val.status !== 'waiting') return;
                const orderId = Math.floor(Math.random() * 90) + 10;
                db.ref('orders/' + orderId).set({ id: orderId, items: val.items, status: 'preparing' });
                db.ref('system/terminal').remove();
                clearCart();
                alert("–û–ø–ª–∞—á–µ–Ω–æ! –ó–∞–∫–∞–∑ #" + orderId);
                switchTab('kiosk', document.querySelectorAll('.nav-btn')[0]);
            });
        }

        db.ref('orders').on('value', snap => {
            const orders = snap.val() || {};
            const kitchen = document.getElementById('kitchen-orders');
            const prep = document.getElementById('prep-numbers');
            const ready = document.getElementById('ready-numbers');
            kitchen.innerHTML = ''; prep.innerHTML = ''; ready.innerHTML = '';
            Object.values(orders).forEach(o => {
                if (o.status === 'preparing') {
                    kitchen.innerHTML += `<div class="order-card"><h3>#${o.id}</h3><p>${o.items.join(', ')}</p><button class="btn-pay" onclick="db.ref('orders/${o.id}').update({status:'ready'})">–ì–û–¢–û–í–û</button></div>`;
                    prep.innerHTML += `<span>${o.id}</span>`;
                } else { ready.innerHTML += `<span>${o.id}</span>`; }
            });
        });

        db.ref('system/terminal').on('value', snap => {
            const v = snap.val();
            document.getElementById('term-amount').innerText = v ? v.amount + ".00 ‚ÇΩ" : "0.00 ‚ÇΩ";
            document.getElementById('term-msg').innerText = v ? "–í–°–¢–ê–í–¨–¢–ï –ö–ê–†–¢–£" : "–°–í–û–ë–û–î–ï–ù";
        });

        function switchTab(id, btn) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) { document.documentElement.requestFullscreen(); } 
            else { if (document.exitFullscreen) document.exitFullscreen(); }
        }
    </script>
</body>
</html>
