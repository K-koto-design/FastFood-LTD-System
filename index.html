<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>K-Donalds Enterprise Systems</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --mcd-yellow: #ffbc0d;
            --mcd-red: #da291c;
            --mcd-black: #272727;
            --sber-green: #21a038;
            --bg: #f4f4f4;
        }

        body, html { margin: 0; padding: 0; font-family: "Helvetica", Arial, sans-serif; background: var(--bg); height: 100%; overflow: hidden; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø –ú–ï–ñ–î–£ –≠–ö–†–ê–ù–ê–ú–ò (–¢–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–±—è) */
        .system-nav {
            position: fixed; bottom: 0; width: 100%; background: #111;
            display: flex; z-index: 9999; overflow-x: auto;
        }
        .system-nav button {
            flex: 1; padding: 12px; color: white; background: none; border: none; font-size: 10px; white-space: nowrap;
        }
        .system-nav button.active { background: var(--mcd-red); }

        .screen { display: none; height: 100vh; width: 100vw; flex-direction: column; }
        .screen.active { display: flex; }

        /* --- 1. –ö–ê–°–°–ê (CASHIER) + 2. –í–¢–û–†–û–ô –≠–ö–†–ê–ù (CUSTOMER DISPLAY) --- */
        #cashier-view { flex-direction: row; }
        .cash-main { flex: 2; background: #fff; padding: 20px; display: flex; flex-direction: column; }
        .product-btns { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; flex: 1; overflow-y: auto; }
        .c-item-btn { background: var(--bg); border: 1px solid #ddd; border-radius: 8px; padding: 10px; font-size: 12px; font-weight: bold; text-align: center; cursor: pointer; }
        
        .customer-side { flex: 1; background: var(--mcd-black); color: white; display: flex; flex-direction: column; padding: 20px; border-left: 5px solid var(--mcd-yellow); }
        .vfd-list { flex: 1; overflow-y: auto; font-family: monospace; font-size: 1.2rem; }
        .vfd-row { display: flex; justify-content: space-between; border-bottom: 1px solid #444; padding: 5px 0; }

        /* --- 3. –ö–£–•–ù–Ø (KITCHEN) --- */
        #kitchen-view { background: #1a1a1a; padding: 20px; color: #fff; }
        .kitchen-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .order-card { background: white; color: black; border-radius: 15px; overflow: hidden; }
        .order-card-header { background: var(--mcd-red); color: white; padding: 10px; font-size: 24px; font-weight: bold; display: flex; justify-content: space-between; }
        .order-card-body { padding: 15px; font-size: 18px; }

        /* --- 4. –¢–ê–ë–õ–û –ö–õ–ò–ï–ù–¢–ê (STATUS BOARD) --- */
        #board-view { flex-direction: row; background: #000; }
        .board-col { flex: 1; text-align: center; padding: 20px; }
        .status-ready { color: var(--mcd-yellow); }
        .status-prep { color: #555; }
        .order-num { font-size: 80px; font-weight: 800; margin: 10px; }

        /* --- 5. –¢–ï–†–ú–ò–ù–ê–õ –û–ü–õ–ê–¢–´ (SBER) --- */
        #terminal-view { background: #000; align-items: center; justify-content: center; }
        .sber-phone { width: 300px; height: 600px; background: #fff; border-radius: 40px; border: 8px solid #333; overflow: hidden; position: relative; color: #333; }
        .sber-header { height: 120px; background: linear-gradient(135deg, #21a038, #084990); padding: 20px; color: white; }
        .sber-pay-btn { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--sber-green); color: white; border: none; width: 80%; padding: 15px; border-radius: 12px; font-weight: bold; font-size: 18px; }

        /* –û–ë–©–ò–ï –≠–õ–ï–ú–ï–ù–¢–´ */
        .btn-pay-mcd { background: var(--mcd-yellow); color: black; border: none; padding: 20px; font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 0 #d49a00; }
        
        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 600px) {
            #cashier-view { flex-direction: column; }
            .customer-side { height: 250px; border-left: none; border-top: 5px solid var(--mcd-yellow); }
        }
    </style>
</head>
<body>

    <div id="cashier-view" class="screen active">
        <div class="cash-main">
            <h2>–ö–ê–°–°–ê (–°–æ—Ç—Ä—É–¥–Ω–∏–∫)</h2>
            <div style="margin-bottom: 10px;">
                <input type="text" id="new-item-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <input type="number" id="new-item-price" placeholder="–¶–µ–Ω–∞">
                <button onclick="addItemToMenu()">–î–û–ë–ê–í–ò–¢–¨ –í –ú–ï–ù–Æ</button>
            </div>
            <div class="product-btns" id="cashier-products"></div>
            <button class="btn-pay-mcd" onclick="switchTo('terminal-view')">–ü–ï–†–ï–ô–¢–ò –ö –û–ü–õ–ê–¢–ï</button>
        </div>
        <div class="customer-side">
            <h3 style="text-align:center; color:var(--mcd-yellow)">–í–ê–® –ó–ê–ö–ê–ó</h3>
            <div class="vfd-list" id="vfd-items"></div>
            <div style="font-size: 30px; font-weight: 800; border-top: 2px solid #fff; padding-top: 10px;">
                –ò–¢–û–ì–û: <span id="vfd-total">0.00</span> ‚ÇΩ
            </div>
        </div>
    </div>

    <div id="kitchen-view" class="screen">
        <h1>üë®‚Äçüç≥ –ó–ê–ö–ê–ó–´ –ù–ê –ö–£–•–ù–Æ</h1>
        <div class="kitchen-grid" id="kitchen-grid"></div>
    </div>

    <div id="board-view" class="screen">
        <div class="board-col">
            <h2 class="status-prep">–ì–û–¢–û–í–ò–¢–°–Ø</h2>
            <div id="board-preparing"></div>
        </div>
        <div class="board-col" style="background: #111;">
            <h2 class="status-ready">–ì–û–¢–û–í–û</h2>
            <div id="board-ready"></div>
        </div>
    </div>

    <div id="terminal-view" class="screen">
        <div class="sber-phone">
            <div class="sber-header">
                <div style="font-size: 14px; opacity: 0.8;">–°–±–µ—Ä–ë–∞–Ω–∫ –û–Ω–ª–∞–π–Ω</div>
                <div style="font-size: 24px; font-weight: bold; margin-top: 10px;">–ö –û–ü–õ–ê–¢–ï</div>
                <div id="terminal-price" style="font-size: 28px;">0.00 ‚ÇΩ</div>
            </div>
            <div style="padding: 20px; text-align: center;">
                <img src="https://img.icons8.com/color/96/visa.png" width="60">
                <p>–î–ï–ë–ï–¢–û–í–ê–Ø –ö–ê–†–¢–ê ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 1234</p>
            </div>
            <button class="sber-pay-btn" onclick="finalizePayment()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –û–ü–õ–ê–¢–£</button>
        </div>
    </div>

    <nav class="system-nav">
        <button onclick="switchTo('cashier-view')" class="active">–ö–ê–°–°–ê/–î–ò–°–ü–õ–ï–ô</button>
        <button onclick="switchTo('kitchen-view')">–ö–£–•–ù–Ø</button>
        <button onclick="switchTo('board-view')">–¢–ê–ë–õ–û –ö–õ–ò–ï–ù–¢–û–í</button>
        <button onclick="switchTo('terminal-view')">–¢–ï–†–ú–ò–ù–ê–õ</button>
    </nav>

    <script>
        // –¢–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBX7BbbkBR7ITiayV132J9LlOqjh3l4AJs",
            authDomain: "fastfood-ltd-system.firebaseapp.com",
            databaseURL: "https://fastfood-ltd-system-default-rtdb.firebaseio.com",
            projectId: "fastfood-ltd-system",
            storageBucket: "fastfood-ltd-system.firebasestorage.app",
            messagingSenderId: "890141225952",
            appId: "1:890141225952:web:6ee1bf30e8408f355ef185",
            measurementId: "G-KP685P8817"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const audio = new Audio('https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptoken=80685955-468a-449e-998a-78567104b281');

        let currentCart = [];
        let currentTotal = 0;
        let lastOrderCount = 0;

        function switchTo(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.system-nav button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        // –ö–ê–°–°–ê: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –±–∞–∑—É
        function addItemToMenu() {
            const name = document.getElementById('new-item-name').value;
            const price = document.getElementById('new-item-price').value;
            if(name && price) {
                db.ref('menu').push({ name, price: parseInt(price) });
            }
        }

        // –†–µ–Ω–¥–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –∫–∞—Å—Å–µ
        db.ref('menu').on('value', snap => {
            const list = document.getElementById('cashier-products');
            list.innerHTML = '';
            const data = snap.val() || {};
            Object.values(data).forEach(item => {
                list.innerHTML += `<div class="c-item-btn" onclick="addToCart('${item.name}', ${item.price})">${item.name}<br>${item.price}‚ÇΩ</div>`;
            });
        });

        function addToCart(name, price) {
            currentCart.push(name);
            currentTotal += price;
            updateDisplays();
        }

        function updateDisplays() {
            document.getElementById('vfd-items').innerHTML = currentCart.map(i => `<div class="vfd-row"><span>${i}</span><span>1.00</span></div>`).join('');
            document.getElementById('vfd-total').innerText = currentTotal.toFixed(2);
            document.getElementById('terminal-price').innerText = currentTotal.toFixed(2) + " ‚ÇΩ";
        }

        function finalizePayment() {
            if(currentTotal === 0) return;
            const id = Math.floor(Math.random() * 900) + 100;
            db.ref('orders/' + id).set({
                id: id, items: currentCart, status: 'preparing'
            }).then(() => {
                currentCart = []; currentTotal = 0; updateDisplays();
                alert("–û–ø–ª–∞—á–µ–Ω–æ! –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: " + id);
                switchTo('cashier-view');
            });
        }

        // –ö–£–•–ù–Ø –ò –¢–ê–ë–õ–û: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        db.ref('orders').on('value', snap => {
            const orders = snap.val() || {};
            const kGrid = document.getElementById('kitchen-grid');
            const boardPrep = document.getElementById('board-preparing');
            const boardReady = document.getElementById('board-ready');
            
            if (Object.keys(orders).length > lastOrderCount) audio.play();
            lastOrderCount = Object.keys(orders).length;

            kGrid.innerHTML = ''; boardPrep.innerHTML = ''; boardReady.innerHTML = '';

            Object.values(orders).forEach(o => {
                if(o.status === 'preparing') {
                    // –ö—É—Ö–Ω—è
                    kGrid.innerHTML += `
                        <div class="order-card">
                            <div class="order-card-header"><span>#${o.id}</span> <button onclick="db.ref('orders/${o.id}').update({status:'ready'})">–ì–û–¢–û–í–û</button></div>
                            <div class="order-card-body">${o.items.join('<br>')}</div>
                        </div>`;
                    // –¢–∞–±–ª–æ
                    boardPrep.innerHTML += `<div class="order-num">${o.id}</div>`;
                } else {
                    boardReady.innerHTML += `<div class="order-num status-ready">${o.id}</div>`;
                }
            });
        });
    </script>
</body>
</html>
